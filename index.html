<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ancient Coptic Dictionary</title>
    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.7.0/jspdf.plugin.autotable.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, push, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAjBbnm8F76BCb9C5fluUyoZ2QnMSXlHOo",
            authDomain: "test-c7bf3.firebaseapp.com",
            databaseURL: "https://test-c7bf3-default-rtdb.firebaseio.com",
            projectId: "test-c7bf3",
            storageBucket: "test-c7bf3.firebasestorage.app",
            messagingSenderId: "573697013702",
            appId: "1:573697013702:web:fe132fc4d796c06bdbe4c7"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('field-form');
            const pdfForm = document.getElementById('pdf-form');
            const bohairicInput = document.getElementById('bohairic');
            const oldCopticInput = document.getElementById('old-coptic');
            const sahidicInput = document.getElementById('sahidic');
            const otherDialectsInput = document.getElementById('other-dialects');
            const meaningInput = document.getElementById('meaning');
            const etymologyInput = document.getElementById('etymology');
            const pdfSortSelect = document.getElementById('pdf-sort');
            const submitButton = document.querySelector('button[type="submit"]');
            const notificationContainer = document.getElementById('notification-container');

            // Create a notification function
            function showNotification(message, isError = false) {
                const notification = document.createElement('div');
                notification.className = `notification ${isError ? 'error' : 'success'}`;
                notification.textContent = message;
                notificationContainer.appendChild(notification);
                
                // Make notification visible with animation
                setTimeout(() => {
                    notification.classList.add('visible');
                }, 10);
                
                // Remove notification after delay
                setTimeout(() => {
                    notification.classList.remove('visible');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 2000);
            }

            // Function to check if entry already exists
            function checkEntryExists(bohairic, sahidic, meaning) {
                return get(ref(database, 'fields'))
                    .then((snapshot) => {
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            return Object.values(data).some(entry => 
                                (entry.bohairic && entry.bohairic.toLowerCase() === bohairic.toLowerCase()) ||
                                (entry.sahidic && entry.sahidic.toLowerCase() === sahidic.toLowerCase()) ||
                                (entry.meaning && entry.meaning.toLowerCase() === meaning.toLowerCase())
                            );
                        }
                        return false;
                    });
            }

            form.addEventListener('submit', (event) => {
                event.preventDefault();
                const bohairic = bohairicInput.value.trim();
                const oldCoptic = oldCopticInput.value.trim();
                const sahidic = sahidicInput.value.trim();
                const otherDialects = otherDialectsInput.value.trim();
                const meaning = meaningInput.value.trim();
                const etymology = etymologyInput.value.trim();

                // Check if at least one field is filled
                if (!bohairic && !oldCoptic && !sahidic && !otherDialects && !meaning && !etymology) {
                    showNotification('Please fill in at least one field before submission!', true);
                    return;
                }

                // Check if entry already exists (basic duplicate check)
                checkEntryExists(bohairic, sahidic, meaning)
                    .then((exists) => {
                        if (exists && (bohairic || sahidic || meaning)) {
                            showNotification('A similar entry already exists!', true);
                            return;
                        }

                        // Entry doesn't exist, proceed with saving
                        return push(ref(database, 'fields/'), {
                            bohairic: bohairic || '',
                            oldCoptic: oldCoptic || '',
                            sahidic: sahidic || '',
                            otherDialects: otherDialects || '',
                            meaning: meaning || '',
                            etymology: etymology || '',
                            timestamp: Date.now()
                        });
                    })
                    .then((result) => {
                        if (result) {
                            showNotification('Entry added successfully! ✅');
                            // Clear all inputs
                            bohairicInput.value = '';
                            oldCopticInput.value = '';
                            sahidicInput.value = '';
                            otherDialectsInput.value = '';
                            meaningInput.value = '';
                            etymologyInput.value = '';
                            bohairicInput.focus();
                        }
                    })
                    .catch((error) => {
                        console.error("Error saving entry: ", error);
                        showNotification('Failed to add entry ❌', true);
                    });
            });

            pdfForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const selectedSort = pdfSortSelect.value;

                // Get all entries
                get(ref(database, 'fields'))
                    .then((snapshot) => {
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            let entries = [];

                            // Convert to array
                            Object.keys(data).forEach(key => {
                                const entry = data[key];
                                entries.push({
                                    bohairic: entry.bohairic || '',
                                    oldCoptic: entry.oldCoptic || '',
                                    sahidic: entry.sahidic || '',
                                    otherDialects: entry.otherDialects || '',
                                    meaning: entry.meaning || '',
                                    etymology: entry.etymology || '',
                                    timestamp: new Date(entry.timestamp).toLocaleDateString()
                                });
                            });

                            if (entries.length > 0) {
                                // Sort entries based on selected option
                                if (selectedSort === 'alphabetical') {
                                    entries.sort((a, b) => a.bohairic.localeCompare(b.bohairic));
                                }
                                
                                // Generate PDF
                                generatePDF(entries);
                            } else {
                                showNotification('No entries found in the database.', true);
                            }
                        } else {
                            showNotification('No entries found in the database.', true);
                        }
                    })
                    .catch((error) => {
                        console.error("Error fetching entries: ", error);
                        showNotification('Failed to generate PDF ❌', true);
                    });
            });

            function generatePDF(entries) {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('landscape');
                    
                    // Add title
                    const title = 'Ancient Coptic Dictionary';
                    doc.setFontSize(18);
                    doc.text(title, 14, 20);
                    
                    // Add date
                    doc.setFontSize(10);
                    doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 30);
                    
                    // Create table with entries
                    const tableColumns = ["Bohairic", "Old Coptic", "Sahidic", "Other Dialects", "Meaning", "Egyptian Etymology", "Date Added"];
                    const tableRows = entries.map(entry => [
                        entry.bohairic,
                        entry.oldCoptic,
                        entry.sahidic,
                        entry.otherDialects,
                        entry.meaning,
                        entry.etymology,
                        entry.timestamp
                    ]);
                    
                    doc.autoTable({
                        head: [tableColumns],
                        body: tableRows,
                        startY: 35,
                        styles: { fontSize: 8 },
                        headStyles: { fillColor: [184, 134, 11] }, // Golden color
                        columnStyles: {
                            0: { cellWidth: 35 },
                            1: { cellWidth: 35 },
                            2: { cellWidth: 35 },
                            3: { cellWidth: 35 },
                            4: { cellWidth: 50 },
                            5: { cellWidth: 50 },
                            6: { cellWidth: 25 }
                        }
                    });
                    
                    // Save PDF
                    const filename = 'coptic_dictionary_entries.pdf';
                    doc.save(filename);
                    
                    showNotification('PDF generated successfully! ✅');
                } catch (error) {
                    console.error("Error generating PDF: ", error);
                    showNotification('Failed to generate PDF ❌', true);
                }
            }
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&display=swap');
        
        body {
            font-family: 'Cinzel', serif;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #d4af37 0%, #f4e4a6 50%, #d4af37 100%);
            color: #8b4513;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,215,0,0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255,215,0,0.1) 0%, transparent 50%);
        }

        .container {
            background: linear-gradient(145deg, #fff8dc, #faf0e6);
            max-width: 100%;
            width: 90%;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 215, 0, 0.3);
            text-align: center;
            position: relative;
            border: 3px solid #d4af37;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #d4af37, #b8860b, #daa520, #d4af37);
            border-radius: 20px;
            z-index: -1;
        }

        h1 {
            margin: 0 0 25px;
            font-size: 2.5rem;
            color: #8b4513;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 600;
        }

        h1::after {
            content: '𓂀';
            display: block;
            font-size: 1.5rem;
            color: #d4af37;
            margin-top: 5px;
        }

        h2 {
            font-size: 1.4rem;
            margin: 30px 0 20px;
            padding-top: 20px;
            border-top: 2px solid #d4af37;
            color: #8b4513;
            position: relative;
        }

        h2::before {
            content: '𓊖';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: -15px;
            background: linear-gradient(145deg, #fff8dc, #faf0e6);
            padding: 0 10px;
            color: #d4af37;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #8b4513;
            text-align: left;
        }

        input, select, button {
            width: calc(100% - 24px);
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 2px solid #d4af37;
            font-family: 'Cinzel', serif;
            background: rgba(255, 248, 220, 0.8);
        }

        input:focus, select:focus {
            outline: none;
            border-color: #b8860b;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
            background: #fff;
        }

        button {
            background: linear-gradient(145deg, #d4af37, #b8860b);
            color: white;
            cursor: pointer;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            background: linear-gradient(145deg, #b8860b, #daa520);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .form-section {
            margin-bottom: 25px;
            background: rgba(255, 248, 220, 0.3);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        #pdf-form {
            background: linear-gradient(145deg, rgba(212, 175, 55, 0.1), rgba(184, 134, 11, 0.1));
            border: 2px solid #d4af37;
        }

        /* Notification styling */
        #notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .notification {
            padding: 15px 25px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            opacity: 0;
            transform: translateX(50px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .notification.success {
            background: linear-gradient(145deg, #228B22, #32CD32);
        }

        .notification.error {
            background: linear-gradient(145deg, #DC143C, #FF6347);
        }

        .notification.visible {
            opacity: 1;
            transform: translateX(0);
        }

        /* Egyptian decorative elements */
        .form-section::before {
            content: '𓈖𓏏𓂋';
            display: block;
            color: #d4af37;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        @media (max-width: 600px) {
            body {
                background: linear-gradient(135deg, #daa520 0%, #f4e4a6 50%, #daa520 100%);
            }

            .container {
                padding: 15px;
                width: 95%;
            }

            h1 {
                font-size: 2rem;
                margin-bottom: 15px;
            }

            input, select, button {
                width: calc(100% - 20px);
                padding: 10px;
                margin-bottom: 12px;
                font-size: 0.9rem;
            }

            .form-section {
                padding: 15px;
                margin-bottom: 20px;
            }

            #notification-container {
                top: 10px;
                right: 10px;
                left: 10px;
            }

            .notification {
                padding: 12px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>𓂋𓈖 𓊪𓏏 - Ancient Coptic Dictionary</h1>
        
        <div class="form-section">
            <form id="field-form">
                <label for="bohairic">Bohairic:</label>
                <input type="text" id="bohairic" placeholder="Enter Bohairic text...">
                
                <label for="old-coptic">Old Coptic:</label>
                <input type="text" id="old-coptic" placeholder="Enter Old Coptic text...">
                
                <label for="sahidic">Sahidic:</label>
                <input type="text" id="sahidic" placeholder="Enter Sahidic text...">
                
                <label for="other-dialects">Other Dialects:</label>
                <input type="text" id="other-dialects" placeholder="Enter other dialects...">
                
                <label for="meaning">Meaning:</label>
                <input type="text" id="meaning" placeholder="Enter meaning...">
                
                <label for="etymology">Egyptian Etymology:</label>
                <input type="text" id="etymology" placeholder="Enter Egyptian etymology...">
                
                <button type="submit">𓈖𓏏𓂋 Add Entry 𓈖𓏏𓂋</button>
            </form>
        </div>
        
        <h2>Download Dictionary</h2>
        <div class="form-section">
            <form id="pdf-form">
                <label for="pdf-sort">Sort Order:</label>
                <select id="pdf-sort" required>
                    <option value="alphabetical">Alphabetical (by Bohairic)</option>
                    <option value="chronological">Chronological (Date Added)</option>
                </select>
                
                <button type="submit">𓊪𓏏𓊖 Generate PDF 𓊪𓏏𓊖</button>
            </form>
        </div>
    </div>
    <!-- Notification container -->
    <div id="notification-container"></div>
</body>
</html>
